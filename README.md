# KRPSim

## Description

**KRPSim** is a simulation tool that uses genetic algorithms to optimize a series of processes based on a given set of resources. It's designed to help evaluate the most efficient process flows to achieve a specific goal within the constraints of limited stock and time.

## Configuration File Format

Configuration files define the initial resources, processes, and optimization targets. Below is the expected format and syntax:

### General Notes

- Lines starting with `#` are treated as comments.
- Refer to the example configuration files in the `resources` folder for guidance.

### Initial Stocks

Define the available stock at the beginning of the simulation. Each stock should be written in the following format, one per line:

```<stock_name>:<quantity>```

### Process Definitions

Each process is defined on a single line using this structure:

```<name>:(<input1>:<qty1>[;<input2>:<qty2>...]):(<output1>:<qty1>[;<output2>:<qty2>...]):<nb_cycle>```

- `<name>`: Unique name of the process.
- `(<input>:<qty>)`: Required inputs and their quantities.
- `(<output>:<qty>)`: Resulting outputs and their quantities.
- `<nb_cycle>`: Number of cycles the process takes to complete.



### Optimization Targets

Define what needs to be optimized. This is specified using a single line containing the `optimize:` keyword:

```optimize:(<stock_name>|time[;<stock_name>|time[...]])```

You can list multiple stock names and/or `time` as targets.

**Examples** can be found in folder ```resources/```


## Running the program

To run the simulation on a file execute the following command:

```./src/krpsim.py <path_to_config_file> <execution_time>```

 - `<path_to_config_file`: Path to config_file
 - `<execution_time>`: Amount of time you want the program to run for to find the optimal solution
**Example:**
```./src/krpsim.py resources/example1.txt 10```
This runs the simulation on `example1.txt` for 10 seconds.

### Saving Results

Once the program finishes running, you will be prompted to save the results. Type `y` to save them. The results will be stored in a file with the following path:

```results/<config_file_name>_<fitness>_<timestamp>.json```

#### Filename Components

- `<config_file_name`: Name of config file given without extension
- `fitness`: Last value for best fitness found after running the algorithm
- `timestamp`: Time at which the algorithm finished running

**Example:**
```results/example1_245.67_20250418T143210.json```

#### Results file format
Results file is comprised of a series of processes and cycles (one on each line) describing what and when a process is run. Each line is of this format:
```<cycle>:<process_name>```
- `<cylce>`: Cycle at which process is executed
- `<process_name>`: Name of process that is executed

### Verifying results

If you chose to save the file, you will then be prompted to verify the results. Type `y` to verify them.
This will run:
```krspsim_verfy.py <config_file_used> <results_file_generated>```

- `<config_file_used>`: Path to config file used to run the algorithm
- `results_file_generated`: Path to results file generated by typing `y` to save them.

This will simulate the processes found and diplayed in results file and show the final output with this format:
```
===== VERIFICATION SUCCESS =====
Final stock:
  example_stock1: 10
  example_stock2: 0
  example_stock3: 200000
Final real cycle: 200
================================
```

You can also run the verification seperately by executing: ```krspsim_verify.py <config_file_used> <results_file_generated>``` yourself
